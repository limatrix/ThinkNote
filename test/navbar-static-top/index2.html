<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Static Top Navbar Example for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="../bootstrap-3.3.5/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="dist/css/wangEditor.min.css">
    <!-- <script src="../bootstrap-3.3.5/dist/js/bootstrap.min.js"></script> -->
    <link rel="stylesheet" href="http://cdn.jsdelivr.net/editor/0.1.0/editor.css">
    <!-- Custom styles for this template -->
    <link href="navbar-static-top.css" rel="stylesheet">

    
    <link href="perfect-scrollbar.min.css" rel="stylesheet">
    <script src="jquery.min.js"></script>
    <script src="perfect-scrollbar.jquery.min.js"></script>
    <style>
	  /*.contentHolder { 
	    position:relative; overflow: auto;
	  }*/
.container {
	width: 98%;
}
  .contentHolder { position:relative; overflow:auto; width:100%;}

	  p {
	  	font-size: 14px;
    line-height: 1.2;
    margin: 1em 1em 1em 0em;
    display: block;
    padding: 0.4em 0em 0.4em 0.2em;
/*    -webkit-margin-before: 1em;
    -webkit-margin-after: 1em;
    -webkit-margin-start: 0px;
    -webkit-margin-end: 0px;*/
	  }

	  .title-border {
/*  		border-right-width:15px;
  		border-right-style:solid;
  		border-right-color:#aaa;*/
  		border-right:1px solid #aaa; 
	  }

    .article-border {
/*      border-right-width:15px;
      border-right-style:solid;
      border-right-color:#aaa;*/
      border-bottom:1px solid #aaa; 
    }

    .center {
      display:table; width:auto; margin-left:auto; margin-right:auto;
    }

    .col-md-9 {
      padding-left: 10px;
      padding-right: 3px;
    }

	</style>
	<style>

    </style>
  </head>

  <body>
    <!-- $(".chatList").scrollTop($(".chatList")[0].scrollHeight); -->
    <!-- Static navbar -->
    <!-- <nav class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Project name</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#about">About</a></li>
            <li><a href="#contact">Contact</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="../navbar/">Default</a></li>
            <li class="active"><a href="./">Static top <span class="sr-only">(current)</span></a></li>
            <li><a href="../navbar-fixed-top/">Fixed top</a></li>
          </ul>
        </div>
      </div>
    </nav> -->


<div class="container">
  <!-- 标题 -->
	<!-- <div class="row clearfix">
		<div class="col-md-12">
			
      <p contentEditable="true" class="article-border">点此添加标题</p>
      <div>
        关键字
      </div>
		</div>
	</div>
 -->
  <!-- 问题记录 -->
  <!-- 滚动条: 需要样式contentHolder, 需要固定高度$('#content').height(winHeight - offset - 100);-->
  <!-- bootstrap居中: style="display:table; width:auto; margin-left:auto; margin-right:auto"  -->
  <!-- perfect 默认显示滚动条：always-visible -->
  <!-- 监听resize：$(window).resize(function() {});  -->
  <!-- 隐藏滚动条：overflow:hidden -->
  <div class="row clearfix">
    <div id="Demo" class="col-md-3 title-border">
      <div id="content" class="contentHolder" style="padding-top:30px;"> 
  		  
        <!-- <p seq="1" onclick="openSection(id)">点此添加标题</p>
        <p seq="2" onclick="openSection(id)">点此添加标题</p>
        <p seq="3" onclick="openSection(id)">点此添加标题</p>
        <p seq="4" onclick="openSection(id)">点此添加标题</p>
        <p seq="5" onclick="openSection(id)">点此添加标题</p>
        <p seq="6" onclick="openSection(id)">点此添加标题</p> -->
        
        <!-- <p seq="6" contentEditable="true">点此添加标题</p> -->
        <!-- <button class="btn btn-primary center" onclick="addTitle(this)">添加标题</button> -->

        <p><a seq="1" href="javascript:openSection();">一一一一一一一一一</a></p>
        <p><a seq="2" href="javascript:openSection();">二二二二二二二二二</a></p>
        <p><a seq="3" href="javascript:openSection();">三三三三三三三三三</a></p>
        <p><a seq="4" href="javascript:openSection();">四四四四四四四四四</a></p>
        <p><a seq="5" href="javascript:openSection();">五五五五五五五五五</a></p>
        <p><a seq="6" href="javascript:openSection(this);">六六六六六六六六六</a></p>
        <p><a seq="7" href="javascript:openSection(this);">七七七七七七七七七</a></p>
        <p><a seq="8" href="javascript:openSection(this);">八八八八八八八八八</a></p>

        
      </div>

      <div id="titleOpt" class="center" style="padding-top:20px;">
		  	<button class="btn btn-primary" onclick="editTitle();">编辑</button>
        &nbsp;&nbsp;&nbsp;&nbsp;
		  	<button class="btn btn-primary">排序</button>
	     </div>
      
    </div>
    <div id="col-content-right" class="col-md-9">
      <div id="main-title">
        <p contentEditable="true">如何写一篇文章</p>
        <p id="currentSectionTitle">关键字 | 关键字 | REFERENCE</p>
      </div>
     <!-- 编辑器 -->
     <div id="section">
      <div id="operation">
        <button type="button" class="btn btn-default btn-xs">reference</button>
        <button type="button" class="btn btn-default btn-xs">markdown</button>
        <button type="button" class="btn btn-default btn-xs">全屏</button>
      </div>
      
      <div class="editor-wrapper">
        <textarea id="editor" placeholder="Content here ...."></textarea>
      </div>

      <button class="btn btn-primary"> SAVE </button>
     </div>
     <!-- 编辑器 -->
    </div>
  </div>
</div>

<!-- /container -->

<!-- <form role="form">
<div class="form-group">
<input class="form-control" id="articleTitle" type="text" placeholder="在此输入段落标题" />
</div>
</form> -->

    
  </body>
<script type="text/javascript" src="dist/js/wangEditor.min.js"></script>
    <!-- only required for loading sample markdown into the textarea -->

<script src="http://cdn.jsdelivr.net/editor/0.1.0/editor.js"></script>
<script src="http://cdn.jsdelivr.net/editor/0.1.0/marked.js"></script>

<script type="text/javascript">
var g_winHeight = 0;

$(document).ready(function() {

  var editor = new Editor();
  editor.render();

// 控件高度设置
	var winHeight = $(window).height(); //浏览器当前窗口可视区域高度
	var offset = $("#content").offset().top;
  g_winHeight = winHeight;
	$('#content').height(winHeight - offset - 100);
  $('#Demo').height(winHeight - offset);
  //$('#content').attr('min-height', winHeight - offset - 30 + 'px');

	//滚动条
	$('#content').perfectScrollbar(); 
}); 

  // 窗口变化时需要
  // 1. 重新计算标题栏高度，因为滚动条需要明确的高度
  // 2. 更新滚动条
  $(window).resize(function() {
    var winHeight = $(window).height(); //浏览器当前窗口可视区域高度
    var offset = $("#content").offset().top;
    $('#content').height(winHeight - offset - 100);
    $('#content').perfectScrollbar("update"); 
  });

  // 需计算seq值
  function addTitle(nextSeq) {
    $("#content").append("<p seq=\""+nextSeq+"\" contentEditable=\"true\">点此添加标题</p>");
    $('#content').perfectScrollbar("update"); 
    
    //将滚动条移动到最下面
    var divHeight = $("#content").height();
    if($('#content').prop("scrollHeight") > divHeight) {
      $('#content').scrollTop($('#content').prop("scrollHeight") - divHeight + 100);
      $('#content').perfectScrollbar("update"); 
    }  
  }

  function addEvent() {
    
      $("#content").on("click","p", function(){
          // 清空预留字
          if($(this).text() == "点此添加标题") {
              $(this).text("");
          }
          // 如果点击的是最后一个，新增
          var pLen = $("#content p").length;
          var seq  = $(this).attr("seq");
          //alert('length ' + pLen + " seq " + seq);
          if(pLen == seq) {
            addTitle(parseInt(seq) + 1);
          }

    });

    // 失去焦点
    $("#content").on("blur","p", function(){
      // 如果什么也没写，就恢复默认
      if($(this).text() == "") {
        $(this).text("点此添加标题");
        return;
      }

      
    });
  }

    function saveHrefTitle() {
      var arr = [];
      $("#content a").each(function(){
        var seq = $(this).attr("seq");
        var text = $(this).text();
        arr.push("<p seq=\""+seq+"\" contentEditable=\"true\">"+text+"</p>");
      });
      console.log(arr);
      return arr;
    }
    function clearHrefTitle() {

      $("#content").empty(); //删除子元素 remove()连这个元素都删
    }
    function displayEditTitle(arr) {
      arr.forEach(function(p){
          $("#content").append(p);
        });
    }
    function hideEditAndSort() {

      $("#titleOpt").empty();
    }
    function displaySave(){

      $("#titleOpt").append('<button class="btn btn-primary" onclick="saveTitle();">保存</button>');
    }
    function editTitle() {
        // 保存Href所有信息
        var arr = saveHrefTitle();
        // 清空
        clearHrefTitle();
        // 重新加载
        displayEditTitle(arr);
        // 添加事件
        addEvent();
        // 隐藏 编辑/排序
        hideEditAndSort();
        // 显示保存
        displaySave();
    }

  function openSection(obj) {
    console.log($(this));
    $("#currentSectionTitle").text($(this).text());
  }

</script>
</html>
